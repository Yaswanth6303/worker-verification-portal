// Prisma schema for SkillVerify Worker Verification Portal

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// User roles enum
enum Role {
  CUSTOMER
  WORKER
  ADMIN
}

// User verification status
enum VerificationStatus {
  PENDING
  VERIFIED
  REJECTED
}

// User model - base for all users
model User {
  id            String   @id @default(cuid())
  fullName      String
  email         String   @unique
  phone         String   @unique
  password      String
  role          Role     @default(CUSTOMER)
  profilePicture String?
  address       String?
  city          String?
  pincode       String?
  isActive      Boolean  @default(true)
  isEmailVerified Boolean @default(false)
  isPhoneVerified Boolean @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  workerProfile WorkerProfile?
  bookingsAsCustomer Booking[] @relation("CustomerBookings")
  reviewsGiven  Review[] @relation("ReviewsGiven")

  @@map("users")
}

// Worker Profile - additional info for workers
model WorkerProfile {
  id                String             @id @default(cuid())
  userId            String             @unique
  user              User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  skills            String[]           // Array of skill names
  experience        String             // e.g., "3-5"
  bio               String?
  hourlyRate        Float?
  verificationStatus VerificationStatus @default(PENDING)
  idProofUrl        String?
  addressProofUrl   String?
  skillCertificates String[]
  rating            Float              @default(0)
  totalReviews      Int                @default(0)
  totalBookings     Int                @default(0)
  isAvailable       Boolean            @default(true)
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt

  // Relations
  bookings          Booking[] @relation("WorkerBookings")
  reviews           Review[]

  @@map("worker_profiles")
}

// Booking model
model Booking {
  id            String   @id @default(cuid())
  customerId    String
  customer      User     @relation("CustomerBookings", fields: [customerId], references: [id])
  workerId      String
  worker        WorkerProfile @relation("WorkerBookings", fields: [workerId], references: [id])
  service       String
  description   String?
  scheduledDate DateTime
  scheduledTime String
  address       String
  status        BookingStatus @default(PENDING)
  amount        Float?
  paymentStatus PaymentStatus @default(PENDING)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  review        Review?

  @@map("bookings")
}

enum BookingStatus {
  PENDING
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum PaymentStatus {
  PENDING
  PAID
  REFUNDED
}

// Review model
model Review {
  id          String   @id @default(cuid())
  bookingId   String   @unique
  booking     Booking  @relation(fields: [bookingId], references: [id])
  customerId  String
  customer    User     @relation("ReviewsGiven", fields: [customerId], references: [id])
  workerId    String
  worker      WorkerProfile @relation(fields: [workerId], references: [id])
  rating      Int      // 1-5
  comment     String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("reviews")
}
